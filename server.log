
> financial-health-dashboard@1.0.0 server
> nodemon --exec "npx tsx server/index.ts"

[33m[nodemon] 3.1.10[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching path(s): *.*[39m
[33m[nodemon] watching extensions: js,mjs,cjs,json[39m
[32m[nodemon] starting `npx tsx server/index.ts`[39m
🤖 AI Service initialized with anthropic - claude-sonnet-4-20250514
🔧 Tools endpoint configured: https://7.mcp.riseanalytics.io
node:events:495
      throw er; // Unhandled 'error' event
      ^

Error: listen EADDRINUSE: address already in use :::3001
    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)
    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)
    at Server.setupListenHandle [as _listen2] (node:net:1811:16)
    at listenInCluster (node:net:1859:12)
    at Server.listen (node:net:1947:7)
    at Function.listen (/home/etoledo/pending-name/node_modules/express/lib/application.js:635:24)
    at ChatbotService (/home/etoledo/pending-name/server/index.ts:373:5)
    at Object.<anonymous> (/home/etoledo/pending-name/server/index.ts:403:16)
    at Module._compile (node:internal/modules/cjs/loader:1356:14)
    at Object.transformer (/home/etoledo/pending-name/node_modules/tsx/dist/register-D46fvsV_.cjs:3:1104)
    at Module.load (node:internal/modules/cjs/loader:1197:32)
    at Module._load (node:internal/modules/cjs/loader:1013:12)
    at ModuleWrap.<anonymous> (node:internal/modules/esm/translators:202:29)
    at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:336:24)
    at async loadESM (node:internal/process/esm_loader:34:7)
    at async handleMainPromise (node:internal/modules/run_main:106:12)
Emitted 'error' event on Server instance at:
    at emitErrorNT (node:net:1838:8)
    at process.processTicksAndRejections (node:internal/process/task_queues:82:21) {
  code: 'EADDRINUSE',
  errno: -98,
  syscall: 'listen',
  address: '::',
  port: 3001
}

Node.js v18.19.1
[31m[nodemon] app crashed - waiting for file changes before starting...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `npx tsx server/index.ts`[39m
🤖 AI Service initialized with anthropic - claude-sonnet-4-20250514
🔧 Tools endpoint configured: https://7.mcp.riseanalytics.io
🚀 Financial Health Dashboard & Chatbot Server running on port 3001
🤖 AI Service: Configured
💬 Chatbot Service: Enabled with streaming responses
⏰ Cache TTL: 300 seconds
🔄 Initializing MCP Server Manager...
🔗 MCP Server URL: https://7.mcp.riseanalytics.io/mcp
✅ MCP Server Manager initialized successfully
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `npx tsx server/index.ts`[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `npx tsx server/index.ts`[39m
🤖 AI Service initialized with anthropic - claude-sonnet-4-20250514
🔧 Tools endpoint configured: https://7.mcp.riseanalytics.io
🚀 Financial Health Dashboard & Chatbot Server running on port 3001
🤖 AI Service: Configured
💬 Chatbot Service: Enabled with streaming responses
⏰ Cache TTL: 300 seconds
🔄 Initializing MCP Server Manager...
🔗 MCP Server URL: https://7.mcp.riseanalytics.io/mcp
✅ MCP Server Manager initialized successfully
[health_1752948193929_pebasi49y] 🏥 Health check requested
[health_1752948193929_pebasi49y] ✅ Health check completed - Status: healthy, AI: configured
🔄 Creating chat session session_1752948193958_gclbxs1 for accounts: 16312
📊 Loading financial data for account: 16312
📊 Processing financial analysis for member 16312 using MCP Server
🔍 Querying MCP server for member: 16312
📡 Sending query to MCP server for member: 16312
🔍 Testing MCP server connection to get database details...
📄 TestConnectionTool raw response: event: message
data: {"result":{"content":[{"type":"text","text":"{\n  \u0022success\u0022: true,\n  \u0022message\u0022: \u0022Connection successful\u0022,\n  \u0022connection_info\u0022: {\n    \u0022account\u0022: \u0022wp48142.east-us-2.azure\u0022,\n    \u0022user\u0022: \u0022SVCUSR_UDAP_ETL_77777_P\u0022,\n    \u0022database\u0022: \u0022TDW_P\u0022,\n    \u0022schema\u0022: \u0022\\u0022\\u0022\u0022,\n    \u0022warehouse\u0022: \u0022WH_LOAD_UDAP_77777_P\u0022,\n    \u0022role\u0022: \u0022TRL_77777_UDAP_ETL_P\u0022,\n    \u0022version\u0022: \u00229.19.3\u0022\n  }\n}"}]},"id":1752948193963,"jsonrpc":"2.0"}


✅ TestConnectionTool parsed response: {
  result: { content: [ [Object] ] },
  id: 1752948193963,
  jsonrpc: '2.0'
}
🔍 Parsed connection data: {
  success: true,
  message: 'Connection successful',
  connection_info: {
    account: 'wp48142.east-us-2.azure',
    user: 'SVCUSR_UDAP_ETL_77777_P',
    database: 'TDW_P',
    schema: '""',
    warehouse: 'WH_LOAD_UDAP_77777_P',
    role: 'TRL_77777_UDAP_ETL_P',
    version: '9.19.3'
  }
}
🗄️ Using database: TDW_P, schema: CU_ANALYTICS
📄 ExecuteQueryTool raw response: event: message
data: {"result":{"content":[{"type":"text","text":"{\n  \u0022success\u0022: false,\n  \u0022message\u0022: \u0022Error executing query: Error: SQL compilation error:\\nObject \\u0027MEMBER_SNAPSHOT\\u0027 does not exist or not authorized. SqlState: 42S02, VendorCode: 2003, QueryId: 01bdcc3b-0c0b-6dca-0089-6d037dcfbff3\u0022,\n  \u0022error_type\u0022: \u0022SnowflakeDbException\u0022\n}"}],"isError":true},"id":1752948194405,"jsonrpc":"2.0"}


📊 ExecuteQueryTool parsed response: {
  result: { content: [ [Object] ], isError: true },
  id: 1752948194405,
  jsonrpc: '2.0'
}
⚠️ Member 16312 not found in MCP server
⚠️ Member 16312 not found in system
🔍 [TESTING] Full MCP Server Response for member 16312:
{
  "exists-state": false,
  "overallScore": "N/A",
  "scoreValue": 0,
  "criteria": {
    "monthlyDeposits": {
      "met": false,
      "value": 0,
      "target": 0,
      "description": "Member not found in system"
    },
    "nsfFees": {
      "met": false,
      "value": 0,
      "target": 0,
      "description": "Member not found in system"
    },
    "balanceRatio": {
      "met": false,
      "value": 0,
      "target": 0,
      "description": "Member not found in system"
    },
    "spendingRatio": {
      "met": false,
      "value": 0,
      "target": 0,
      "description": "Member not found in system"
    }
  },
  "recommendations": [],
  "encouragementMessage": "",
  "aiModelInfo": {
    "provider": "anthropic",
    "model": "claude-sonnet-4-20250514",
    "maxTokens": 2000,
    "capabilities": {
      "tier": "latest",
      "contextWindow": 200000,
      "strengths": [
        "Latest features",
        "Enhanced reasoning",
        "Improved accuracy"
      ],
      "costTier": "premium"
    }
  }
}
✅ Chat session session_1752948193958_gclbxs1 created successfully
✅ Created chat session: session_1752948193958_gclbxs1 for accounts: 16312
💬 Streaming response for session session_1752948193958_gclbxs1
💬 Processing message for session session_1752948193958_gclbxs1: What is my financial health score?...
✅ Completed streaming response for session session_1752948193958_gclbxs1
[31m[nodemon] app crashed - waiting for file changes before starting...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `npx tsx server/index.ts`[39m
🤖 AI Service initialized with anthropic - claude-sonnet-4-20250514
🔧 Tools endpoint configured: https://7.mcp.riseanalytics.io
node:events:495
      throw er; // Unhandled 'error' event
      ^

Error: listen EADDRINUSE: address already in use :::3001
    at __node_internal_captureLargerStackTrace (node:internal/errors:496:5)
    at __node_internal_uvExceptionWithHostPort (node:internal/errors:593:12)
    at Server.setupListenHandle [as _listen2] (node:net:1811:16)
    at listenInCluster (node:net:1859:12)
    at Server.listen (node:net:1947:7)
    at Function.listen (/home/etoledo/pending-name/node_modules/express/lib/application.js:635:24)
    at ChatbotService (/home/etoledo/pending-name/server/index.ts:373:5)
    at Object.<anonymous> (/home/etoledo/pending-name/server/index.ts:403:16)
    at Module._compile (node:internal/modules/cjs/loader:1356:14)
    at Object.transformer (/home/etoledo/pending-name/node_modules/tsx/dist/register-D46fvsV_.cjs:3:1104)
    at Module.load (node:internal/modules/cjs/loader:1197:32)
    at Module._load (node:internal/modules/cjs/loader:1013:12)
    at ModuleWrap.<anonymous> (node:internal/modules/esm/translators:202:29)
    at ModuleJob.run (node:internal/modules/esm/module_job:195:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:336:24)
    at async loadESM (node:internal/process/esm_loader:34:7)
    at async handleMainPromise (node:internal/modules/run_main:106:12)
Emitted 'error' event on Server instance at:
    at emitErrorNT (node:net:1838:8)
    at process.processTicksAndRejections (node:internal/process/task_queues:82:21) {
  code: 'EADDRINUSE',
  errno: -98,
  syscall: 'listen',
  address: '::',
  port: 3001
}

Node.js v18.19.1
[31m[nodemon] app crashed - waiting for file changes before starting...[39m
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `npx tsx server/index.ts`[39m
🤖 AI Service initialized with anthropic - claude-sonnet-4-20250514
🔧 Tools endpoint configured: https://7.mcp.riseanalytics.io
🚀 Financial Health Dashboard & Chatbot Server running on port 3001
🤖 AI Service: Configured
💬 Chatbot Service: Enabled with streaming responses
⏰ Cache TTL: 300 seconds
🔄 Initializing MCP Server Manager...
🔗 MCP Server URL: https://7.mcp.riseanalytics.io/mcp
✅ MCP Server Manager initialized successfully
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `npx tsx server/index.ts`[39m
🤖 AI Service initialized with anthropic - claude-sonnet-4-20250514
🔧 Tools endpoint configured: https://7.mcp.riseanalytics.io
🚀 Financial Health Dashboard & Chatbot Server running on port 3001
🤖 AI Service: Configured
💬 Chatbot Service: Enabled with streaming responses
⏰ Cache TTL: 300 seconds
🔄 Initializing MCP Server Manager...
🔗 MCP Server URL: https://7.mcp.riseanalytics.io/mcp
✅ MCP Server Manager initialized successfully
[31m[nodemon] app crashed - waiting for file changes before starting...[39m
